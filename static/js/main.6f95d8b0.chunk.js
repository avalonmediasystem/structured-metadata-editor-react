(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{145:function(e,t,n){e.exports=n.p+"static/media/utah_phillips_one.786f6474.mp3"},154:function(e,t,n){e.exports=n(364)},159:function(e,t,n){},364:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"handleEditingTimespans",function(){return L}),n.d(a,"handleStructureMasterFile",function(){return G}),n.d(a,"handleWaveformMasterFile",function(){return q});var i=n(0),r=n.n(i),s=n(22),l=n.n(s),o=n(6),c=n(7),u=n(11),m=n(10),d=n(12),p=(n(159),n(9)),h=n(37),f=n.n(h),v=n(68),g=n(94),b=n.n(g),y="https://spruce.dlib.indiana.edu",O=new Headers;O.append("Content-Type","application/json");var T=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"getRequest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O,n="".concat(y,"/master_files/").concat("d791sg30j","/").concat(e);return b.a.get(n,{headers:t})}},{key:"postRequest",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O,a="".concat(y,"/master_files/").concat("d791sg30j","/").concat(e);return b.a.post(a,t,{headers:n})}}]),e}(),S=n(13),k="ADD_HEADING",E="BUILD_SM_UI",C="DELETE_ITEM",j="ADD_DROP_TARGETS",D="REMOVE_DROP_TARGETS",I="SET_ACTIVE_DRAG_SOURCE",w="REMOVE_ACTIVE_DRAG_SOURCES",M="HANDLE_LIST_ITEM_DROP",x="INIT_PEAKS",R="INSERT_SEGMENT",A="DELETE_SEGMENT",N="ACTIVATE_SEGMENT",H="SAVE_SEGMENT",F="REVERT_SEGMENT",_="UPDATE_SEGMENT",P="DRAG_SEGMENT",V="TEMP_INSERT_SEGMENT",U="TEMP_DELETE_SEGMENT";function z(e,t){return function(n,a){n(function(e,t){return{type:x,smData:e,options:t}}(e,t));var i=a().peaksInstance;void 0!==i.events&&i.events.subscribe(function(e){n(W(e))})}}function B(e,t){return{type:_,segment:e,state:t}}function W(e){return{type:P,payload:e}}var L=function(e){return{type:"IS_EDITING_TIMESPAN",code:e}},G=function(e){return{type:"RETRIEVED_STRUCTURE",code:e}},q=function(e){return{type:"RETRIEVED_WAVEFORM",code:e}},Z=n(49),J=n(366),K=n(367),Q=n(368),X=n(378),Y=n(369),$=n(377),ee=n(375),te=n(145),ne=n.n(te),ae=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).zoomIn=function(){n.props.peaksInstance.peaks.zoom.zoomIn()},n.zoomOut=function(){n.props.peaksInstance.peaks.zoom.zoomOut()},n.seekTime=function(){var e=parseFloat(n.state.seekTime);Number.isNaN(e)||n.props.peaksInstance.peaks.player.seek(e)},n.state={seekTime:""},n.waveformContainer=r.a.createRef(),n.mediaPlayer=r.a.createRef(),n.handleSubmit=n.handleSubmit.bind(Object(Z.a)(n)),n.handleChange=n.handleChange.bind(Object(Z.a)(n)),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.waveformRef(this.waveformContainer.current),this.props.mediaPlayerRef(this.mediaPlayer.current)}},{key:"handleSubmit",value:function(e){this.seekTime(),e.preventDefault()}},{key:"handleChange",value:function(e){this.setState({seekTime:e.target.value})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{id:"waveform-container",ref:this.waveformContainer}),r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:12,md:6},r.a.createElement("audio",{controls:!0,ref:this.mediaPlayer,src:ne.a,type:"audio/mp3"},"Your browser does not support the audio element.")),r.a.createElement(K.a,{xs:12,md:6,className:"text-right"},r.a.createElement(Q.a,{inline:!0,onSubmit:this.handleSubmit},r.a.createElement(X.a,null,r.a.createElement(Y.a,null,r.a.createElement($.a,{className:"glyphicon glyphicon-zoom-in",onClick:this.zoomIn}),r.a.createElement($.a,{className:"glyphicon glyphicon-zoom-out",onClick:this.zoomOut})))," ",r.a.createElement(ee.a,{className:"form-control",type:"text",value:this.state.seekTime,onChange:this.handleChange,placeholder:"0"})," ",r.a.createElement($.a,{onClick:this.seekTime},"Seek")))))}}]),t}(i.Component),ie=Object(S.b)(function(e){return{peaksInstance:e.peaksInstance}})(ae),re=n(376),se=n(14),le=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={show:!1},n.handleDismiss=function(){n.setState({show:!1}),n.props.clearAlert()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.message&&this.setState({show:!0})}},{key:"componentDidUpdate",value:function(e,t){this.props.message&&!t.show&&this.setState({show:!0})}},{key:"componentWillReceiveProps",value:function(e){Object(se.isEmpty)(e)&&this.setState({show:!1})}},{key:"render",value:function(){var e=this.props,t=e.alertStyle,n=e.message;return this.state.show?r.a.createElement(re.a,{bsStyle:t,onDismiss:this.handleDismiss},r.a.createElement("p",null,n)):null}}]),t}(i.Component),oe="Unauthorized to access the masterfile",ce="Requested masterfile not found",ue="Successfully saved to masterfile",me="Network error, please try again",de="There was an error fetching the Structured Metadata from server",pe="There was an error initializing the PeakJS waveform",he="Time ahead has timespans reaching the end of media file, there is no available time to insert a new timespan";function fe(e,t){var n={alertStyle:"danger",clearAlert:t};return 401===e?n.message=oe:404===e?n.message=ce:e>=200&&e<300?(n.alertStyle="success",n.message=ue):-2===e?n.message=de:-3===e?n.message=pe:-4===e?(n.alertStyle="warning",n.message=he):n.message=me,n}var ve=new T,ge={container:null,mediaElement:null,dataUri:null,dataUriDefaultFormat:"json",keyboard:!0,pointMarkerColor:"#006eb0",showPlayheadTime:!0,zoomWaveformColor:"rgba(217, 217, 217, 1)"},be=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={alertObj:null,hasError:!1},n.clearAlert=function(){n.setState({alertObj:null})},n.waveformContainer=null,n.mediaPlayer=null,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){ge.container=this.waveformContainer,ge.mediaElement=this.mediaPlayer,this.initializePeaks()}},{key:"handleError",value:function(e){console.log("TCL: WaveformContainer -> handleError -> error",e);var t=null;void 0!==e.response?t=e.response.status:void 0!==e.request&&(t=-3);var n=fe(t,this.clearAlert);this.setState({alertObj:n,hasError:!0})}},{key:"initializePeaks",value:function(){var e=Object(v.a)(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ve.getRequest("waveform.json");case 3:t=e.sent,ge.dataUri=t.request.responseURL,this.props.initPeaks(this.props.smData,ge),this.props.handleWaveformFile(0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.handleError(e.t0);case 12:case"end":return e.stop()}},e,this,[[0,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.alertObj,a=t.hasError,i=this.props.forms;return r.a.createElement("section",{className:"waveform-section"},!i.waveformRetrieved&&a?r.a.createElement(le,n):r.a.createElement(ie,{waveformRef:function(t){return e.waveformContainer=t},mediaPlayerRef:function(t){return e.mediaPlayer=t}}))}}]),t}(i.Component),ye=Object(S.b)(function(e){return{smData:e.smData,forms:e.forms}},function(e){return Object(p.a)({},a,{initPeaks:function(t,n){return e(z(t,n))},handleWaveformFile:function(t){return e(q(t))}})})(be),Oe=n(379),Te=n(71),Se=n(149),ke=n.n(Se),Ee=n(38),Ce=n.n(Ee),je=function(){function e(){var t=this;Object(o.a)(this,e),this.dndHelper={addSpanBefore:function(e,n){var a=t.getParentDiv(n,e),i=a.items.map(function(e){return e.id}).indexOf(n.id);a.items[i+1]&&"optional"!==a.items[i+1].type&&a.items.splice(i+1,0,t.createDropZoneObject())},addSpanAfter:function(e,n){var a=t.getParentDiv(n,e),i=a.items.map(function(e){return e.id}).indexOf(n.id);a.items.splice(i,0,t.createDropZoneObject())},stuckInMiddle:function(e,t,n){return 0!==e&&e!==t.length-1&&"span"===n.items[e-1].type&&"span"===n.items[e+1].type},addSpanToEmptyHeader:function(e,n){var a=t.findWrapperHeaders(e,n);a.after&&a.after.items.splice(0,0,t.createDropZoneObject())}}}return Object(c.a)(e,[{key:"createDropZoneObject",value:function(){return{type:"optional",id:Ce()()}}},{key:"createSpanObject",value:function(e){return{id:Ce()(),type:"span",label:e.timespanTitle,begin:e.beginTime,end:e.endTime}}},{key:"deleteListItem",value:function(e,t){var n=Object(se.cloneDeep)(t),a=this.findItem(e,t),i=this.getParentDiv(a,n),r=Object(se.findIndex)(i.items,{id:a.id});return i.items.splice(r,1),n}},{key:"determineDropTargets",value:function(e,t){var n=Object(se.cloneDeep)(t);if("span"===e.type){var a=this.findWrapperSpans(e,this.getItemsOfType("span",n)),i=this.getParentDiv(e,n),r=i?i.items:[],s=r.map(function(e){return e.id}).indexOf(e.id);if(this.dndHelper.stuckInMiddle(s,r,i))return n;if(0!==s&&"div"===r[s-1].type){var l=r[s-1];l.items?l.items.push(this.createDropZoneObject()):l.items=[this.createDropZoneObject()]}if(s!==r.length-1&&"div"===r[s+1].type){var o=r[s+1];o.items?o.items.unshift(this.createDropZoneObject()):o.items=[this.createDropZoneObject()]}var c=this.getParentDiv(i,n),u=c?c.items.map(function(e){return e.id}).indexOf(i.id):null;if(0===s){if(null===u)return n;c&&(c.items.splice(u,0,this.createDropZoneObject()),a.before&&this.dndHelper.addSpanBefore(n,a.before))}a.after&&this.dndHelper.addSpanAfter(n,a.after),a.after||this.dndHelper.addSpanToEmptyHeader(i,n)}return n}},{key:"doesTimeOverlap",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_SAFE_INTEGER,a=this.toMs,i=!0;for(var r in e=a(e),t){var s=a(t[r].begin),l=a(t[r].end);if(e>=s&&e<l){i=!1;break}if(e/1e3>n){i=!1;break}}return i}},{key:"doesTimespanOverlap",value:function(e,t,n){var a=this.toMs,i=n.filter(function(t){return a(e)<a(t.begin)});return 0!==i.length&&a(t)>a(i[0].begin)}},{key:"findItem",value:function(e,t){var n=null;return function t(a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;c.id===e&&(n=c),c.items&&c.items.length>0&&t(c.items)}}catch(u){r=!0,s=u}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(t),n}},{key:"findItemByLabel",value:function(e,t){var n=null;return function t(a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;c.label===e&&(n=c),c.items&&t(c.items)}}catch(u){r=!0,s=u}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(t),n}},{key:"findWrapperSpans",value:function(e,t){var n=this.toMs,a={before:null,after:null},i=t.filter(function(t){return n(e.begin)>=n(t.end)}),r=t.filter(function(t){return n(e.end)<=n(t.begin)});return a.before=i.length>0?i[i.length-1]:null,a.after=r.length>0?r[0]:null,a}},{key:"findWrapperHeaders",value:function(e,t){var n={before:null,after:null},a=this.getParentDiv(e,t),i=a?a.items.map(function(e){return e.label}).indexOf(e.label):null;return n.before=void 0!==a.items[i-1]?a.items[i-1]:null,n.after=void 0!==a.items[i+1]?a.items[i+1]:null,n}},{key:"getItemsOfType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return function t(a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;if(c.type===e){var u=Object(p.a)({},c);delete u.items,n.push(u)}c.items&&t(c.items)}}catch(m){r=!0,s=m}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(t),n}},{key:"getParentDiv",value:function(e,t){var n=null;return function e(t,a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;if(c.items){if(c.items.filter(function(e){return t.id===e.id}).length>0){n=c;break}e(t,c.items)}}}catch(u){r=!0,s=u}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(e,t),n}},{key:"getValidHeadings",value:function(e,t){var n=[],a=[],i=function e(t,a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;if(c.items){if(c.items.filter(function(e){return e.id===t.id}).length>0){c.items;var u=Object(Te.a)(c,["items"]);n.push(u)}e(t,c.items)}}}catch(m){r=!0,s=m}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}},r=this.getItemsOfType("div",t);if(e.before||e.after||(n=r),e.before&&i(e.before,t),e.after&&i(e.after,t),!e.before&&e.after||e.before&&!e.after){var s=this.getValidHeadingForEmptySpans(e,t);n=n.concat(s)}return r.forEach(function(e){var t=!1;n=n.filter(function(n){return!(!t&&n.label===e.label)||(a.push(n),t=!0,!1)})}),a}},{key:"getValidHeadingForEmptySpans",value:function(e,t){var n=this,a=null,i=function(e,a){var i=n.findWrapperHeaders(e,t);switch(a){case"before":return i.before?i.before:e;case"after":return i.after?i.after:e;default:return e}},r=[],s=function e(t,n){if(t!==n){var a=t.items;if(a){var i=!0,s=!1,l=void 0;try{for(var o,c=a[Symbol.iterator]();!(i=(o=c.next()).done);i=!0){var u=o.value;if("div"===u.type){u.items;var m=Object(Te.a)(u,["items"]);r.push(m)}e(u,n)}}catch(d){s=!0,l=d}finally{try{i||null==c.return||c.return()}finally{if(s)throw l}}}}};if(!e.after&&e.before){var l=this.getParentDiv(e.before,t);s(a=i(l,"after"),l)}if(!e.before&&e.after){var o=this.getParentDiv(e.after,t);s(a=i(o,"before"),o)}var c=a,u=(c.items,Object(Te.a)(c,["items"]));return r.push(u),r}},{key:"handleListItemDrop",value:function(e,t,n){var a=Object(se.cloneDeep)(n),i=this.findItem(e.id,a),r=this.getParentDiv(i,a),s=r.items.map(function(e){return e.id}).indexOf(i.id);r.items.splice(s,1);var l=this.getParentDiv(t,a),o=l.items.map(function(e){return e.id}).indexOf(t.id);return l.items.splice(o,0,i),this.removeDropTargets(a)}},{key:"insertNewHeader",value:function(e,t){var n=Object(se.cloneDeep)(t),a=this.findItem(e.headingChildOf,n)||n[0];return a&&a.items.unshift({id:Ce()(),type:"div",label:e.headingTitle,items:[]}),n}},{key:"insertNewTimespan",value:function(e,t){var n=Object(se.cloneDeep)(t),a=this.findItem(e.timespanChildOf,n),i=this.createSpanObject(e),r=0;if(a){var s=a.items.filter(function(e){return"span"===e.type}),l=this.findWrapperSpans(i,s);l.before&&(r=Object(se.findIndex)(a.items,{id:l.before.id})+1),a.items.splice(r,0,i)}return{newSpan:i,updatedData:n}}},{key:"removeActiveDragSources",value:function(e){return[function e(t){return t.items?(t.items=t.items.map(function(t){return e(t)}),t):(t.active&&(t.active=!1),t)}(e[0])]}},{key:"removeDropTargets",value:function(e){return[function e(t,n){return t.items?(t.items=t.items.filter(function(e){return e.type!==n}).map(function(t){return e(t,n)}),t):t}(Object(se.cloneDeep)(e)[0],"optional")]}},{key:"toMs",value:function(e){return ke.a.duration(e).asMilliseconds()}},{key:"toHHmmss",value:function(e){var t=parseInt(""+100*e)/100,n=Math.floor(t/3600),a=Math.floor(t/60),i=Math.round(t%60*100)/100,r=n<10?"0".concat(n):"".concat(n),s=a<10?"0".concat(a):"".concat(a),l=i.toFixed(2);return l=i<10?"0".concat(l):"".concat(l),"".concat(r,":").concat(s,":").concat(l)}},{key:"updateHeading",value:function(e,t){var n=Object(se.cloneDeep)(t);return this.findItem(e.id,n).label=e.headingTitle,n}},{key:"validateBeforeEndTimeOrder",value:function(e,t){return!e||!t||!(this.toMs(e)>=this.toMs(t))}},{key:"validTimeFormat",value:function(e){return e&&3===e.split(":").length}}]),e}(),De=n(370),Ie=new je;function we(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=Ie.findItem(e,t);if("div"===a.type||"root"===a.type)return{headingTitle:a.label};if("span"===a.type){var i=Ie.getParentDiv(a,t);return{beginTime:a.begin,endTime:a.end,timespanChildOf:i?i.id:"",timespanTitle:a.label,clonedSegment:n.segments.getSegment(e)}}}function Me(e,t){if(!e||-1===e.indexOf(":"))return null;var n=Ie.validTimeFormat(e),a=Ie.doesTimeOverlap(e,t);return n&&a?"success":n&&a?null:"error"}function xe(e,t,n,a){var i;if(void 0!==a&&void 0!==a.player&&(i=Math.round(100*a.player.getDuration())/100),!t||-1===t.indexOf(":"))return null;var r=Ie.validTimeFormat(t),s=Ie.doesTimeOverlap(t,n,i),l=Ie.validateBeforeEndTimeOrder(e,t),o=Ie.doesTimespanOverlap(e,t,n);return r&&s&&l&&!o?"success":r&&s&&l&&!o?null:"error"}function Re(e){return e.length>2?"success":e.length>0?"error":null}function Ae(e){return e.length>2}function Ne(e,t,n,a){var i;return void 0!==a&&void 0!==a.player&&(i=Math.round(100*a.player.getDuration())/100),Ie.validTimeFormat(e)?Ie.validTimeFormat(t)?Ie.doesTimeOverlap(e,n)?Ie.doesTimeOverlap(t,n)?Ie.validateBeforeEndTimeOrder(e,t)?Ie.doesTimespanOverlap(e,t,n)?{valid:!1,message:"New timespan region overlaps an existing timespan region"}:i<Ie.toMs(t)/1e3?{valid:!1,message:"End time overlaps duration of the media file"}:{valid:!0}:{valid:!1,message:"Begin time must start before end time"}:{valid:!1,message:"End time overlaps an existing timespan region"}:{valid:!1,message:"Begin time overlaps an existing timespan region"}:{valid:!1,message:"Invalid end time format"}:{valid:!1,message:"Invalid begin time format"}}var He=new je,Fe=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={headingTitle:"",headingChildOf:"",childOfOptions:[]},n.handleCancelClick=function(){n.props.toggleHeading()},n.handleChildOfChange=function(e){n.setState({headingChildOf:e.target.value})},n.handleHeadingChange=function(e){n.setState({headingTitle:e.target.value})},n.handleSubmit=function(e){var t=n.state,a={headingChildOf:t.headingChildOf,headingTitle:t.headingTitle};e.preventDefault(),n.props.onSubmit(a),n.clearFormValues()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.smData.length>0&&this.processOptions()}},{key:"componentDidUpdate",value:function(e){Object(se.isEqual)(this.props.smData,e.smData)||this.processOptions()}},{key:"clearFormValues",value:function(){this.setState({headingTitle:"",headingChildOf:"",childOfOptions:[]})}},{key:"formIsValid",value:function(){var e=this.state.headingTitle;return e&&e.length>0}},{key:"getOptions",value:function(){var e=He.getItemsOfType("root",this.props.smData),t=He.getItemsOfType("div",this.props.smData);return e.concat(t).map(function(e){return r.a.createElement("option",{value:e.id,key:e.id},e.label)})}},{key:"processOptions",value:function(){var e=this.getOptions();this.setState({childOfOptions:e})}},{key:"render",value:function(){var e=this.state.headingTitle;return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement(X.a,{controlId:"headingTitle",validationState:Re(e)},r.a.createElement(De.a,null,"Title"),r.a.createElement(ee.a,{type:"text",value:e,onChange:this.handleHeadingChange}),r.a.createElement(ee.a.Feedback,null)),r.a.createElement(X.a,{controlId:"headingChildOf"},r.a.createElement(De.a,null,"Child Of"),r.a.createElement(ee.a,{componentClass:"select",placeholder:"select",onChange:this.handleChildOfChange,value:this.state.headingChildOf},r.a.createElement("option",{value:""},"Select..."),this.state.childOfOptions)),r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:12},r.a.createElement(Y.a,{className:"pull-right"},r.a.createElement($.a,{onClick:this.props.cancelClick},"Cancel"),r.a.createElement($.a,{bsStyle:"primary",type:"submit",disabled:!this.formIsValid()},"Save")))))}}]),t}(i.Component),_e=Object(S.b)(function(e){return{smData:e.smData}},a)(Fe);function Pe(e){return{type:E,payload:e}}var Ve=new je,Ue=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={message:null},n.submit=function(e){var t,a=n.props.smData,i={headingChildOf:e.headingChildOf,headingTitle:e.headingTitle};t=Ve.insertNewHeader(i,a),n.props.buildSMUI(t),n.props.cancelClick()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(_e,{onSubmit:this.submit,cancelClick:this.props.cancelClick})}}]),t}(i.Component),ze=Object(S.b)(function(e){return{smData:e.smData}},function(e){return{buildSMUI:function(t){return e(Pe(t))}}})(Ue),Be=n(27),We=n(40),Le=["#80A590","#2A5459","#FBB040"],Ge=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"initSegments",value:function(e){var t=this,n=[],a=0;return function e(i){var r=!0,s=!1,l=void 0;try{for(var o,c=i[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var u=o.value;if("span"===u.type){a=a>1?0:a;var m=u.begin,d=u.end,p=u.label,h=u.id;n.push({startTime:t.toMs(m),endTime:t.toMs(d),labelText:p,id:h,color:Le[a]}),a++}u.items&&u.items.length>0&&e(u.items)}}catch(f){s=!0,l=f}finally{try{r||null==c.return||c.return()}finally{if(s)throw l}}}(e),n}},{key:"insertNewSegment",value:function(e,t){var n=e.begin,a=e.end,i=e.label,r=e.id;return t.segments.add({startTime:this.toMs(n),endTime:this.toMs(a),labelText:i,id:r}),t}},{key:"insertTempSegment",value:function(e){var t,n=this.roundOff(e.player.getCurrentTime()),a=this.roundOff(e.player.getDuration()),i=n,r=this.sortSegments(e,"startTime");return r.map(function(e){return i>=e.startTime&&i<=e.endTime&&(i=e.endTime+.01),i}),t=i+60,r.map(function(e){i<e.startTime&&(e.endTime-e.startTime<60&&t>=e.endTime&&(t=e.startTime-.01),t>=e.startTime&&t<e.endTime&&(t=e.startTime-.01));return t>a&&(t=a),t}),i<a&&t>i&&(e.player.seek(i),e.segments.add({startTime:i,endTime:t,editable:!0,color:Le[2],id:"temp-segment"})),e}},{key:"deleteSegments",value:function(e,t){return"div"===e.type&&function e(n){var a=n.items,i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;"span"===c.type&&t.segments.removeById(c.id),c.items&&c.items.length>0&&e(c)}}catch(u){r=!0,s=u}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(e),t.segments.removeById(e.id),t}},{key:"rebuildPeaks",value:function(e){var t=this,n=this.sortSegments(e,"startTime");return e.segments.removeAll(),n.forEach(function(n,a){n.color=t.isOdd(a)?Le[1]:Le[0],e.segments.add(n)}),e}},{key:"activateSegment",value:function(e,t){var n=t.segments.removeById(e),a=Object(We.a)(n,1)[0];t.segments.add(Object(p.a)({},a,{editable:!0,color:Le[2]}));var i=t.segments.getSegment(e).startTime;return t.player.seek(i),t}},{key:"deactivateSegment",value:function(e,t){var n=this.sortSegments(t,"startTime").map(function(e){return e.id}).indexOf(e),a=t.segments.removeById(e),i=Object(We.a)(a,1)[0];return t.segments.add(Object(p.a)({},i,{editable:!1,color:this.isOdd(n)?Le[1]:Le[0]})),t}},{key:"saveSegment",value:function(e,t){var n=e.beginTime,a=e.endTime,i=e.clonedSegment;return t.segments.removeById(i.id),t.segments.add(Object(p.a)({},i,{startTime:this.toMs(n),endTime:this.toMs(a)})),t}},{key:"revertSegment",value:function(e,t){return t.segments.removeById(e.id),t.segments.add(e),t}},{key:"updateSegment",value:function(e,t,n){var a=t.beginTime,i=t.endTime,r=this.toMs(a),s=this.toMs(i);if(r<e.endTime&&e.startTime!==r){var l=n.segments.removeById(e.id),o=Object(We.a)(l,1)[0];return n.segments.add(Object(p.a)({},o,{startTime:r})),n}if(s>e.startTime&&e.endTime!==s){var c=n.segments.removeById(e.id),u=Object(We.a)(c,1)[0];return n.segments.add(Object(p.a)({},u,{endTime:s})),n}return n}},{key:"validateSegment",value:function(e,t){var n=this.sortSegments(t,"startTime"),a=this.findWrapperSegments(e,n),i=this.roundOff(t.player.getDuration()),r=this.roundOff(e.startTime),s=this.roundOff(e.endTime);return null!==a.before&&r<=a.before.endTime&&(e.startTime=a.before.endTime+.01),null!==a.after&&s>=a.after.startTime&&(e.endTime=a.after.startTime-.01),null===a.after&&s>i&&(e.endTime=i),e}},{key:"findWrapperSegments",value:function(e,t){var n={before:null,after:null},a=t.map(function(e){return e.id}).indexOf(e.id);return n.before=a>0?t[a-1]:null,n.after=a<t.length-1?t[a+1]:null,n}},{key:"isOdd",value:function(e){return e%2}},{key:"toMs",value:function(e){var t=e.split(":"),n=Object(We.a)(t,3),a=n[0],i=n[1],r=n[2];return 3600*parseInt(a)+60*parseInt(i)+(""===r?0:parseFloat(r))}},{key:"sortSegments",value:function(e,t){return e.segments.getSegments().sort(function(e,n){return e[t]-n[t]})}},{key:"roundOff",value:function(e){return Math.round(100*e)/100}}]),e}(),qe=new je,Ze=new Ge,Je=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).buildHeadingsOptions=function(){var e=n.props.smData,t={begin:n.state.beginTime,end:n.state.endTime},a=qe.findWrapperSpans(t,n.allSpans),i=qe.getValidHeadings(a,e);n.setState({validHeadings:i})},n.clearHeadingOptions=function(){n.setState({validHeadings:[]})},n.handleInputChange=function(e){n.setState(Object(Be.a)({},e.target.id,e.target.value),n.updateChildOfOptions())},n.handleSubmit=function(e){e.preventDefault();var t=n.state,a=t.beginTime,i=t.endTime,r=t.timespanChildOf,s=t.timespanTitle;n.props.cancelClick(),n.props.onSubmit({beginTime:a,endTime:i,timespanChildOf:r,timespanTitle:s}),n.clearFormValues()},n.handleTimeChange=function(e,t){n.setState({isTyping:!0}),n.setState(Object(Be.a)({},e.target.id,e.target.value),function(){t(),n.updateChildOfOptions();var e=n.props,a=e.initSegment,i=e.peaksInstance.peaks.segments.getSegment(a.id);n.localValidTimespans().valid&&n.props.updateSegment(i,n.state)})},n.handleCancelClick=function(){n.props.cancelClick()},n.handleChildOfChange=function(e){n.setState({timespanChildOf:e.target.value})},n.state={beginTime:"",endTime:"",timespanChildOf:"",timespanTitle:"",validHeadings:[],isTyping:!1},n.allSpans=null,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.smData;this.allSpans=qe.getItemsOfType("span",e)}},{key:"componentDidUpdate",value:function(e){var t=this.props.smData;Object(se.isEqual)(t,e.smData)||(this.allSpans=qe.getItemsOfType("span",t))}},{key:"componentWillReceiveProps",value:function(e){if(e.timespanOpen&&!this.state.isTyping){var t=e.initSegment,n=e.isInitializing,a=e.peaksInstance,i=e.segment;if(t!==this.props.initSegment&&n){var r=t.startTime,s=t.endTime;this.setState({beginTime:qe.toHHmmss(r),endTime:qe.toHHmmss(s)}),this.props.updateInitialize(!1)}if(this.props.peaksInstance!==a&&!n){var l=Ze.validateSegment(i,a.peaks),o=l.startTime,c=l.endTime;this.setState({beginTime:qe.toHHmmss(o),endTime:qe.toHHmmss(c)},this.updateChildOfOptions())}}}},{key:"clearFormValues",value:function(){this.setState({beginTime:"",endTime:"",timespanChildOf:"",timespanTitle:"",validHeadings:[],isTyping:!1})}},{key:"formIsValid",value:function(){var e=Ae(this.state.timespanTitle),t=this.state.timespanChildOf.length>0,n=this.localValidTimespans();return e&&t&&n.valid}},{key:"updateChildOfOptions",value:function(){this.localValidTimespans().valid?this.buildHeadingsOptions():this.clearHeadingOptions()}},{key:"localValidTimespans",value:function(){var e=this.state;return Ne(e.beginTime,e.endTime,this.allSpans,this.props.peaksInstance.peaks)}},{key:"render",value:function(){var e=this,t=this.state,n=t.beginTime,a=t.endTime,i=t.timespanChildOf,s=t.timespanTitle;return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement(X.a,{controlId:"timespanTitle",validationState:Re(s)},r.a.createElement(De.a,null,"Title"),r.a.createElement(ee.a,{type:"text",value:s,onChange:this.handleInputChange}),r.a.createElement(ee.a.Feedback,null)),r.a.createElement(J.a,null,r.a.createElement(K.a,{sm:6},r.a.createElement(X.a,{controlId:"beginTime",validationState:Me(n,this.allSpans)},r.a.createElement(De.a,null,"Begin Time"),r.a.createElement(ee.a,{type:"text",value:n,placeholder:"00:00:00",onChange:function(t){e.handleTimeChange(t,function(){e.setState({isTyping:!1})})}}),r.a.createElement(ee.a.Feedback,null))),r.a.createElement(K.a,{sm:6},r.a.createElement(X.a,{controlId:"endTime",validationState:xe(n,a,this.allSpans,this.props.peaksInstance.peaks)},r.a.createElement(De.a,null,"End Time"),r.a.createElement(ee.a,{type:"text",value:a,placeholder:"00:00:00",onChange:function(t){e.handleTimeChange(t,function(){e.setState({isTyping:!1})})}}),r.a.createElement(ee.a.Feedback,null)))),r.a.createElement(X.a,{controlId:"timespanChildOf"},r.a.createElement(De.a,null,"Child Of"),r.a.createElement(ee.a,{componentClass:"select",placeholder:"select",onChange:this.handleChildOfChange,value:i},r.a.createElement("option",{value:""},"Select..."),this.state.validHeadings.map(function(e){return r.a.createElement("option",{value:e.id,key:e.id},e.label)}))),r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:12},r.a.createElement(Y.a,{className:"pull-right"},r.a.createElement($.a,{onClick:this.handleCancelClick},"Cancel"),r.a.createElement($.a,{bsStyle:"primary",type:"submit",disabled:!this.formIsValid()},"Save")))))}}]),t}(i.Component),Ke={updateSegment:B},Qe=Object(S.b)(function(e){return{smData:e.smData,peaksInstance:e.peaksInstance,segment:e.peaksInstance.segment}},Ke)(Je),Xe=new je,Ye=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={message:null},n.submit=function(e){var t=Xe.insertNewTimespan(e,n.props.smData),a=t.newSpan,i=t.updatedData;n.props.insertNewSegment(a),n.props.buildSMUI(i),n.props.cancelClick()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(Qe,Object.assign({},this.props,{onSubmit:this.submit}))}}]),t}(i.Component),$e=Object(S.b)(function(e){return{smData:e.smData}},function(e){return{buildSMUI:function(t){return e(Pe(t))},insertNewSegment:function(t){return e({type:R,payload:t})}}})(Ye),et={section:{margin:"4rem 0"},well:{marginTop:"1rem"}},tt=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={headingOpen:!1,timespanOpen:!1,initSegment:null,isInitializing:!0,alertObj:null,disabled:!0},n.updateInitializeFlag=function(e){n.setState({isInitializing:e})},n.clearAlert=function(){n.setState({alertObj:null,disabled:!0}),n.props.handleEditingTimespans(1)},n.handleCancelHeadingClick=function(){n.setState({headingOpen:!1}),n.clearAlert()},n.handleHeadingClick=function(){n.props.handleEditingTimespans(0),n.deleteTempSegment(),n.setState({alertObj:null,headingOpen:!0,timespanOpen:!1,disabled:!1})},n.handleCancelTimespanClick=function(){n.deleteTempSegment(),n.setState({timespanOpen:!1}),n.clearAlert()},n.handleTimeSpanClick=function(){n.props.handleEditingTimespans(0),n.state.timespanOpen||n.props.createTempSegment();var e=n.props.peaksInstance.peaks.segments.getSegment("temp-segment");null===e?n.setState({alertObj:fe(-4,n.clearAlert),headingOpen:!1,disabled:!1}):(n.props.handleEditingTimespans(0),n.setState({initSegment:e,headingOpen:!1,timespanOpen:!0,isInitializing:!0,disabled:!1}))},n.deleteTempSegment=function(){null!==n.state.initSegment&&n.props.deleteTempSegment(n.state.initSegment.id)},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e={cancelClick:this.handleCancelTimespanClick,initSegment:this.state.initSegment,isInitializing:this.state.isInitializing,timespanOpen:this.state.timespanOpen,updateInitialize:this.updateInitializeFlag},t=this.props.forms,n=t.structureRetrieved,a=t.waveformRetrieved;return n&&a?r.a.createElement("section",{style:et.section},r.a.createElement(le,this.state.alertObj),r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:6},r.a.createElement($.a,{block:!0,onClick:this.handleHeadingClick,disabled:this.state.disabled&&this.props.forms.editingDisabled},"Add a Heading")),r.a.createElement(K.a,{xs:6},r.a.createElement($.a,{block:!0,onClick:this.handleTimeSpanClick,disabled:this.state.disabled&&this.props.forms.editingDisabled},"Add a Timespan"))),r.a.createElement(Oe.a,{in:this.state.headingOpen},r.a.createElement("div",{className:"well",style:et.well},r.a.createElement(ze,{cancelClick:this.handleCancelHeadingClick}))),r.a.createElement(Oe.a,{in:this.state.timespanOpen},r.a.createElement("div",{className:"well",style:et.well},r.a.createElement($e,e)))):null}}]),t}(i.Component),nt={createTempSegment:function(){return{type:V}},deleteTempSegment:function(e){return{type:U,payload:e}},handleEditingTimespans:L},at=Object(S.b)(function(e){return{smData:e.smData,peaksInstance:e.peaksInstance,forms:e.forms}},nt)(tt),it="span",rt=n(31),st=n(371),lt=n(372),ot=n(32),ct=function(e){return r.a.createElement(st.a,{id:"tooltip"},e)},ut=function(e){return r.a.createElement("div",{className:"edit-controls-wrapper"},r.a.createElement(lt.a,{placement:"left",overlay:ct("Save")},r.a.createElement($.a,{bsStyle:"link",disabled:!e.formIsValid,onClick:e.handleSaveClick},r.a.createElement(ot.a,{icon:"save"}))),r.a.createElement(lt.a,{placement:"right",overlay:ct("Cancel"),onClick:e.handleCancelClick},r.a.createElement($.a,{bsStyle:"link"},r.a.createElement(ot.a,{icon:"minus-circle"}))))},mt=new je,dt=new Ge,pt={formControl:{margin:"0 5px"}},ht=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={beginTime:"",endTime:"",timespanTitle:"",clonedSegment:{},isTyping:!1},n.handleCancelClick=function(){n.props.revertSegment(n.state.clonedSegment),n.props.cancelFn()},n.handleInputChange=function(e,t){n.setState({isTyping:!0}),n.setState(Object(Be.a)({},e.target.id,e.target.value),function(){t();var e=n.props,a=e.item,i=e.peaksInstance.peaks.segments.getSegment(a.id);n.formIsValid()&&n.props.updateSegment(i,n.state)})},n.handleSaveClick=function(){n.props.saveSegment(n.state);var e=n.state,t=e.beginTime,a=e.endTime,i=e.timespanTitle;n.props.saveFn(n.props.item.id,{beginTime:t,endTime:a,timespanTitle:i})},n.tempSmData=void 0,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.smData,n=e.item,a=e.peaksInstance;this.tempSmData=Object(se.cloneDeep)(t),this.setState(we(n.id,this.tempSmData,a.peaks)),this.tempSmData=mt.deleteListItem(n.id,this.tempSmData),this.allSpans=mt.getItemsOfType("span",this.tempSmData),this.props.activateSegment(n.id),this.props.changeSegment()}},{key:"componentWillReceiveProps",value:function(e){if(this.props.peaksInstance!==e.peaksInstance&&e.segment&&!this.state.isTyping){var t=e.segment,n=e.peaksInstance,a=dt.validateSegment(t,n.peaks),i=a.startTime,r=a.endTime;this.setState({beginTime:mt.toHHmmss(i),endTime:mt.toHHmmss(r)})}}},{key:"formIsValid",value:function(){var e=this.state,t=e.beginTime,n=e.endTime,a=Ae(this.state.timespanTitle),i=Ne(t,n,this.allSpans,this.props.peaksInstance.peaks);return a&&i.valid}},{key:"render",value:function(){var e=this,t=this.state,n=t.beginTime,a=t.endTime,i=t.timespanTitle;return r.a.createElement(Q.a,{inline:!0},r.a.createElement("div",{className:"row-wrapper"},r.a.createElement("div",null,r.a.createElement(X.a,{controlId:"timespanTitle",validationState:Re(i)},r.a.createElement(De.a,null,"Title"),r.a.createElement(ee.a,{type:"text",style:pt.formControl,value:i,onChange:function(t){e.handleInputChange(t,function(){e.setState({isTyping:!1})})}})),r.a.createElement(X.a,{controlId:"beginTime",validationState:Me(n,this.allSpans)},r.a.createElement(De.a,null,"Begin Time"),r.a.createElement(ee.a,{type:"text",style:pt.formControl,value:n,onChange:function(t){e.handleInputChange(t,function(){e.setState({isTyping:!1})})}})),r.a.createElement(X.a,{controlId:"endTime",validationState:xe(n,a,this.allSpans,this.props.peaksInstance.peaks)},r.a.createElement(De.a,null,"End Time"),r.a.createElement(ee.a,{type:"text",style:pt.formControl,value:a,onChange:function(t){e.handleInputChange(t,function(){e.setState({isTyping:!1})})}}))),r.a.createElement(ut,{formIsValid:this.formIsValid(),handleSaveClick:this.handleSaveClick,handleCancelClick:this.handleCancelClick})))}}]),t}(i.Component),ft={activateSegment:function(e){return{type:N,payload:e}},revertSegment:function(e){return{type:F,payload:e}},saveSegment:function(e){return{type:H,payload:e}},updateSegment:B,changeSegment:W},vt=Object(S.b)(function(e){return{smData:e.smData,peaksInstance:e.peaksInstance,segment:e.peaksInstance.segment}},ft)(ht),gt={formControl:{margin:"0 5px",width:"300px"}},bt=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={headingTitle:""},n.handleCancelClick=function(){n.props.cancelFn()},n.handleInputChange=function(e){n.setState(Object(Be.a)({},e.target.id,e.target.value))},n.handleSaveClick=function(){var e=n.state.headingTitle;n.props.saveFn(n.props.item.id,{headingTitle:e})},n.tempSmData=void 0,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.smData;this.tempSmData=Object(se.cloneDeep)(e),this.setState(we(this.props.item.id,this.tempSmData))}},{key:"formIsValid",value:function(){return Ae(this.state.headingTitle)}},{key:"render",value:function(){var e=this.state.headingTitle;return r.a.createElement(Q.a,{inline:!0},r.a.createElement("div",{className:"row-wrapper"},r.a.createElement("div",null,r.a.createElement(X.a,{controlId:"headingTitle",validationState:Re(e)},r.a.createElement(De.a,null,"Title"),r.a.createElement(ee.a,{type:"text",style:gt.formControl,value:e,onChange:this.handleInputChange}))),r.a.createElement(ut,{formIsValid:this.formIsValid(),handleSaveClick:this.handleSaveClick,handleCancelClick:this.handleCancelClick})))}}]),t}(i.Component),yt=Object(S.b)(function(e){return{smData:e.smData}})(bt),Ot=new je,Tt=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleCancelClick=function(e){n.props.handleEditFormCancel()},n.handleSaveClick=function(e,t){var a=Object(se.cloneDeep)(n.props.smData),i=Ot.findItem(e,a);i=n.addUpdatedValues(i,t),n.props.buildSMUI(a),n.props.handleEditFormCancel()},n.type=n.props.item.type,n.id=n.props.item.id,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"addUpdatedValues",value:function(e,t){return"div"===e.type||"root"===e.type?e.label=t.headingTitle:"span"===e.type&&(e.label=t.timespanTitle,e.begin=t.beginTime,e.end=t.endTime),e}},{key:"render",value:function(){var e=this.props.item;return"span"===e.type?r.a.createElement(vt,{item:e,cancelFn:this.handleCancelClick,saveFn:this.handleSaveClick}):"div"===e.type||"root"===e.type?r.a.createElement(yt,{item:e,cancelFn:this.handleCancelClick,saveFn:this.handleSaveClick}):void 0}}]),t}(i.Component),St=Object(S.b)(function(e){return{smData:e.smData}},function(e){return{buildSMUI:function(t){return e(Pe(t))}}})(Tt),kt=n(99),Et=n(373),Ct={buttonToolbar:{display:"flex",justifyContent:"flex-end"},popover:{width:"250px",height:"auto"}},jt=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={deleteMessage:"",showDeleteConfirm:!1,target:null},n.handleConfirmDelete=function(){n.props.handleDelete(),n.enableEditing(),n.setState({deleteMessage:"",showDeleteConfirm:!1})},n.handleDeleteClick=function(e){var t=n.props.item,a=t.childrenCount,i=t.label,r="Are you sure you'd like to delete <strong>".concat(i,"</strong>");a>0&&(r+=" and it's <strong>".concat(a,"</strong> child items")),r+="?",n.props.handleEditingTimespans(0),n.setState({deleteMessage:r,showDeleteConfirm:!0,target:e.target})},n.cancelDeleteClick=function(e){n.enableEditing(),n.setState({showDeleteConfirm:!1})},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"enableEditing",value:function(){this.props.handleEditingTimespans(1)}},{key:"render",value:function(){var e=this.props,t=e.handleShowDropTargetsClick,n=e.handleEditClick,a=e.item,i=e.forms,s=this.state,l=s.deleteMessage,o=s.showDeleteConfirm;return r.a.createElement("div",{className:"edit-controls-wrapper"},"span"===a.type&&r.a.createElement($.a,{bsStyle:"link",disabled:i.editingDisabled,onClick:t},r.a.createElement(ot.a,{icon:"dot-circle"})),r.a.createElement($.a,{bsStyle:"link",onClick:n,disabled:i.editingDisabled},r.a.createElement(ot.a,{icon:"pen"})),"root"!==a.type&&r.a.createElement(r.a.Fragment,null,r.a.createElement($.a,{bsStyle:"link",onClick:this.handleDeleteClick,disabled:i.editingDisabled},r.a.createElement(ot.a,{icon:"trash"})),r.a.createElement(kt.a,{show:o,target:this.state.target,placement:"left",container:this},r.a.createElement(Et.a,{id:"popover-contained",title:"Confirm delete?",style:Ct.popover},r.a.createElement("p",{dangerouslySetInnerHTML:{__html:l}}),r.a.createElement(Y.a,{style:Ct.buttonToolbar},r.a.createElement($.a,{bsStyle:"danger",bsSize:"xsmall",onClick:this.handleConfirmDelete},"Delete"),r.a.createElement($.a,{bsSize:"xsmall",onClick:this.cancelDeleteClick},"Cancel"))))))}}]),t}(i.Component),Dt=Object(S.b)(function(e){return{forms:e.forms}},function(e){return{handleEditingTimespans:function(t){return e(L(t))}}})(jt);var It=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={editing:!1},n.handleDelete=function(){var e=n.props.item;n.props.deleteItem(e.id),n.props.deleteSegment(e)},n.handleEditClick=function(){n.props.handleEditingTimespans(0),n.setState({editing:!0})},n.handleEditFormCancel=function(){n.setState({editing:!1}),n.props.handleEditingTimespans(1)},n.handleShowDropTargetsClick=function(){var e=n.props,t=e.addDropTargets,a=e.item,i=e.removeActiveDragSources,r=e.removeDropTargets,s=e.setActiveDragSource;r(),!0!==a.active?(i(),t(a),s(a.id)):i()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.item.begin,a=e.item.end,i=e.item.items,s=e.item.label,l=e.item.type,o=e.item.active,c=e.connectDragSource,u=e.connectDropTarget,m=i&&i.length>0?r.a.createElement(Ft,{items:i}):null,d={childrenCount:t.items?t.items.length:0,label:t.label,type:t.type};return c(u(r.a.createElement("li",{className:o?"active":""},this.state.editing&&r.a.createElement(St,{item:t,handleEditFormCancel:this.handleEditFormCancel}),!this.state.editing&&r.a.createElement("div",{className:"row-wrapper"},"span"===l&&r.a.createElement("span",{className:"structure-title"},s," (",n," - ",a,")"),("div"===l||"root"===l)&&r.a.createElement("div",{className:"structure-title heading"},s),r.a.createElement(Dt,{handleDelete:this.handleDelete,handleEditClick:this.handleEditClick,item:d,handleShowDropTargetsClick:this.handleShowDropTargetsClick})),m)))}}]),t}(i.Component),wt={deleteItem:function(e){return{type:C,id:e}},addDropTargets:function(e){return{type:j,payload:e}},removeDropTargets:function(){return{type:D}},removeActiveDragSources:function(){return{type:w}},setActiveDragSource:function(e){return{type:I,id:e}},deleteSegment:function(e){return{type:A,payload:e}},handleEditingTimespans:L},Mt=Object(rt.DropTarget)(it,{canDrop:function(e,t){return!0}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),isOverCurrent:t.isOver({shallow:!0}),canDrop:t.canDrop(),itemType:t.getItemType()}})(Object(rt.DragSource)(it,{beginDrag:function(e){return{id:e.item.id}}},function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}})(It)),xt=Object(S.b)(function(e){return{smData:e.smData}},wt)(Mt),Rt={li:{border:"2px #999 dashed",opacity:.3},liHovered:{border:"5px #999 dashed",opacity:.5}};var At=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isOver;return(0,e.connectDropTarget)(r.a.createElement("li",{className:"row-wrapper",style:t?Rt.liHovered:Rt.li},"Drop here"))}}]),t}(i.Component),Nt=Object(rt.DropTarget)(it,{hover:function(e,t,n){},drop:function(e,t,n){var a=t.getItem();e.handleListItemDrop(a,e.item)}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),isOverCurrent:t.isOver({shallow:!0}),canDrop:t.canDrop(),itemType:t.getItemType()}})(At),Ht=Object(S.b)(null,function(e){return{handleListItemDrop:function(t,n){return e({type:M,dragSource:t,dropTarget:n})}}})(Nt),Ft=function(e){return r.a.createElement("ul",{className:"structure-list"},e.items.map(function(e,t){return e?"optional"===e.type?r.a.createElement(Ht,{key:t,item:e}):r.a.createElement(xt,{key:e.id,item:e}):null}))},_t=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={alertObj:{}},n.clearAlert=function(){n.setState({alertObj:null})},n.handleSaveItClick=function(){var e={json:n.props.smData[0]};n.apiUtils.postRequest("structure.json",e).then(function(e){var t=fe(e.status,n.clearAlert);n.setState({alertObj:t})}).catch(function(e){n.handleSaveError(e)})},n.apiUtils=new T,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(v.a)(f.a.mark(function e(){var t,n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.apiUtils.getRequest("structure.json");case 3:t=e.sent,n=this.addIds([t.data]),this.markRootElement(n),this.props.buildSMUI(n),this.props.handleStructureFile(0),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("TCL: StructureOutputContainer -> }catch -> error",e.t0),this.handleFetchError(e.t0);case 14:case"end":return e.stop()}},e,this,[[0,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"addIds",value:function(e){var t=Object(se.cloneDeep)(e);return function e(t){var n=!0,a=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;l.id=Ce()(),l.items&&l.items.length>0&&e(l.items)}}catch(o){a=!0,i=o}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}}(t),t}},{key:"markRootElement",value:function(e){e.length>0&&(e[0].type="root")}},{key:"handleFetchError",value:function(e){var t=fe(void 0!==e.response?e.response.status:-2,this.clearAlert);this.setState({alertObj:t})}},{key:"handleSaveError",value:function(e){console.log("TCL: handleSaveError -> error",e);var t=fe(void 0!==e.response?e.response.status:e.request.status,this.clearAlert);this.setState({alertObj:t})}},{key:"render",value:function(){var e=this.props,t=e.smData,n=void 0===t?[]:t,a=e.forms,i=this.state.alertObj;return r.a.createElement("section",null,a.structureRetrieved?r.a.createElement("div",null,r.a.createElement("h3",null,"HTML Structure Tree from a masterfile in server"),r.a.createElement(le,i),r.a.createElement("br",null),r.a.createElement(Ft,{items:n}),r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:12,className:"text-right"},r.a.createElement($.a,{bsStyle:"primary",onClick:this.handleSaveItClick},"Save Structure")))):r.a.createElement(le,i))}}]),t}(i.Component),Pt=Object(S.b)(function(e){return{smData:e.smData,forms:e.forms}},function(e){return{buildSMUI:function(t){return e(Pe(t))},handleStructureFile:function(t){return e(G(t))}}})(_t),Vt=n(151),Ut=n.n(Vt),zt=n(50),Bt=n(39);zt.b.add(Bt.a,Bt.b,Bt.c,Bt.d,Bt.e);var Wt=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(rt.DragDropContextProvider,{backend:Ut.a},r.a.createElement("div",{className:"container"},r.a.createElement("h1",null,"Test Structural Metadata Editor"),r.a.createElement(ye,null),r.a.createElement(at,null),r.a.createElement(Pt,null)))}}]),t}(i.Component),Lt=n(29),Gt={editingDisabled:!1,structureRetrieved:!1,waveformRetrieved:!1},qt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IS_EDITING_TIMESPAN":return 0===t.code?Object.assign({},e,{editingDisabled:!0}):Object.assign({},e,{editingDisabled:!1});case"RETRIEVED_STRUCTURE":if(0===t.code)return Object.assign({},e,{structureRetrieved:!0});break;case"RETRIEVED_WAVEFORM":if(0===t.code)return Object.assign({},e,{waveformRetrieved:!0});break;default:return e}},Zt=new je,Jt=[],Kt=null,Qt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case k:return(Kt=Object(se.cloneDeep)(e)).push(t.payload),Kt;case E:return t.payload;case C:return Zt.deleteListItem(t.id,e);case j:return Zt.determineDropTargets(t.payload,e);case D:return Zt.removeDropTargets(e);case I:return Kt=Object(se.cloneDeep)(e),Zt.findItem(t.id,Kt).active=!0,Kt;case w:return Zt.removeActiveDragSources(e);case M:return Zt.handleListItemDrop(t.dragSource,t.dropTarget,e);default:return e}},Xt=n(152),Yt=n.n(Xt),$t=n(374),en=new Ge,tn={peaks:{},events:null,segment:null},nn=null,an=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tn,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case x:var n=en.initSegments(t.smData),a=Yt.a.init(Object(p.a)({},t.options,{segments:n}));return{peaks:a,events:Object($t.a)(a,"segments.dragged"),segment:Object(p.a)({},e.segment)};case R:return nn=en.insertNewSegment(t.payload,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:en.rebuildPeaks(nn)});case A:return nn=en.deleteSegments(t.payload,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:en.rebuildPeaks(nn)});case N:return nn=en.activateSegment(t.payload,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:nn});case H:nn=en.deactivateSegment(t.payload.clonedSegment.id,Object(p.a)({},e.peaks));var i=en.saveSegment(t.payload,Object(p.a)({},nn));return Object(p.a)({},e,{peaks:i});case F:return nn=en.deactivateSegment(t.payload.id,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:en.revertSegment(t.payload,Object(p.a)({},nn))});case _:return nn=en.updateSegment(t.segment,t.state,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:Object(p.a)({},nn)});case P:return Object(p.a)({},e,{segment:t.payload});case V:return nn=en.insertTempSegment(Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:Object(p.a)({},nn)});case U:return e.peaks.segments.removeById(t.payload),Object(p.a)({},e);default:return e}},rn=Object(Lt.combineReducers)({forms:qt,smData:Qt,peaksInstance:an}),sn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ln(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var on=n(153),cn=Object(Lt.createStore)(rn,Object(Lt.applyMiddleware)(on.a));l.a.render(r.a.createElement(S.a,{store:cn},r.a.createElement(Wt,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/structured-metadata-editor-react",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/structured-metadata-editor-react","/service-worker.js");sn?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ln(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):ln(e)})}}()}},[[154,1,2]]]);
//# sourceMappingURL=main.6f95d8b0.chunk.js.map