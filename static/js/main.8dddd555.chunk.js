(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{143:function(e,t,n){e.exports=n.p+"static/media/utah_phillips_one.786f6474.mp3"},153:function(e,t,n){e.exports=n(363)},158:function(e,t,n){},363:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"handleResponse",function(){return G}),n.d(a,"closeAlert",function(){return W}),n.d(a,"handleEditingTimespans",function(){return q});var i=n(0),r=n.n(i),s=n(22),l=n.n(s),o=n(4),c=n(5),u=n(11),m=n(8),d=n(10),p=(n(158),n(13)),h=n(38),f=n.n(h),v=n(67),g=n(93),b=n.n(g),y="https://spruce.dlib.indiana.edu",O=new Headers;O.append("Content-Type","application/json");var S=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"getRequest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O,n="".concat(y,"/master_files/").concat("d791sg30j","/").concat(e);return b.a.get(n,{headers:t})}},{key:"postRequest",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O,a="".concat(y,"/master_files/").concat("d791sg30j","/").concat(e);return b.a.post(a,t,{headers:n})}}]),e}(),T=n(9),E="ADD_HEADING",k="BUILD_SM_UI",j="DELETE_ITEM",C="ADD_DROP_TARGETS",D="REMOVE_DROP_TARGETS",I="SET_ACTIVE_DRAG_SOURCE",w="REMOVE_ACTIVE_DRAG_SOURCES",x="HANDLE_LIST_ITEM_DROP",M="INIT_PEAKS",N="INSERT_SEGMENT",H="DELETE_SEGMENT",A="ACTIVATE_SEGMENT",R="SAVE_SEGMENT",F="REVERT_SEGMENT",P="UPDATE_SEGMENT",_="DRAG_SEGMENT",V="TEMP_INSERT_SEGMENT",z="TEMP_DELETE_SEGMENT",B=function(e,t){return function(n,a){n(function(e,t){return{type:M,smData:e,options:t}}(e,t));var i=a().peaksInstance;void 0!==i.events&&i.events.subscribe(function(e){n(L(e))})}};function U(e,t){return{type:P,segment:e,state:t}}function L(e){return{type:_,payload:e}}var G=function(e){return{type:"API_RESPONSE",code:e}},W=function(){return{type:"CLOSE_ALERT"}},q=function(e){return{type:"IS_EDITING_TIMESPAN",code:e}},Z=n(31),J=n(365),K=n(366),Q=n(367),Y=n(374),$=n(368),X=n(375),ee=n(372),te=n(143),ne=n.n(te),ae=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).zoomIn=function(){n.props.peaksInstance.peaks.zoom.zoomIn()},n.zoomOut=function(){n.props.peaksInstance.peaks.zoom.zoomOut()},n.seekTime=function(){var e=parseFloat(n.state.seekTime);Number.isNaN(e)||n.props.peaksInstance.peaks.player.seek(e)},n.state={seekTime:""},n.waveformContainer=r.a.createRef(),n.mediaPlayer=r.a.createRef(),n.handleSubmit=n.handleSubmit.bind(Object(Z.a)(n)),n.handleChange=n.handleChange.bind(Object(Z.a)(n)),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.waveformRef(this.waveformContainer.current),this.props.mediaPlayerRef(this.mediaPlayer.current)}},{key:"handleSubmit",value:function(e){this.seekTime(),e.preventDefault()}},{key:"handleChange",value:function(e){this.setState({seekTime:e.target.value})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{id:"waveform-container",ref:this.waveformContainer}),r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:12,md:6},r.a.createElement("audio",{controls:!0,ref:this.mediaPlayer,src:ne.a,type:"audio/mp3"},"Your browser does not support the audio element.")),r.a.createElement(K.a,{xs:12,md:6,className:"text-right"},r.a.createElement(Q.a,{inline:!0,onSubmit:this.handleSubmit},r.a.createElement(Y.a,null,r.a.createElement($.a,null,r.a.createElement(X.a,{className:"glyphicon glyphicon-zoom-in",onClick:this.zoomIn}),r.a.createElement(X.a,{className:"glyphicon glyphicon-zoom-out",onClick:this.zoomOut})))," ",r.a.createElement(ee.a,{className:"form-control",type:"text",value:this.state.seekTime,onChange:this.handleChange,placeholder:"0"})," ",r.a.createElement(X.a,{onClick:this.seekTime},"Seek")))))}}]),t}(i.Component),ie=Object(T.b)(function(e){return{peaksInstance:e.peaksInstance}})(ae),re=n(377),se=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={error:""},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({error:e,errorInfo:t})}},{key:"render",value:function(){return this.state.error?r.a.createElement(re.a,{bsStyle:"danger"},r.a.createElement("p",null,"Error rendering Peak.js waveform")):this.props.children}}]),t}(i.Component),le=new S,oe={container:null,mediaElement:null,dataUri:null,dataUriDefaultFormat:"json",keyboard:!0,pointMarkerColor:"#006eb0",showPlayheadTime:!0,zoomWaveformColor:"rgba(217, 217, 217, 1)"},ce=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).waveformContainer=null,n.mediaPlayer=null,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){oe.container=this.waveformContainer,oe.mediaElement=this.mediaPlayer,this.initializePeaks()}},{key:"initializePeaks",value:function(){var e=Object(v.a)(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,le.getRequest("waveform.json");case 3:t=e.sent,oe.dataUri=t.request.responseURL,this.props.initPeaks(this.props.smData,oe),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),void 0!==e.t0.response?this.props.handleResponse(e.t0.response.status):void 0!==e.t0.request?this.props.handleResponse(e.t0.request.status):this.props.handleResponse(-1);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("section",{className:"waveform-section"},r.a.createElement(se,null,r.a.createElement(ie,{waveformRef:function(t){return e.waveformContainer=t},mediaPlayerRef:function(t){return e.mediaPlayer=t}})))}}]),t}(i.Component),ue=Object(T.b)(function(e){return{smData:e.smData}},function(e){return Object(p.a)({},a,{initPeaks:function(t,n){return e(B(t,n))}})})(ce),me=n(376),de=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleDismiss=n.handleDismiss.bind(Object(Z.a)(n)),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleDismiss",value:function(){this.props.closeAlert()}},{key:"createAlert",value:function(){var e=this.props.showForms.statusCode;switch(!0){case 401===e:return r.a.createElement("div",null,r.a.createElement(re.a,{bsStyle:"danger",onDismiss:this.handleDismiss},r.a.createElement("p",null,"Unauthorized to access the masterfile.")));case 404===e:return r.a.createElement("div",null,r.a.createElement(re.a,{bsStyle:"danger",onDismiss:this.handleDismiss},r.a.createElement("p",null,"Requested masterfile not found.")));case e>=200&&e<300:return r.a.createElement("div",null,r.a.createElement(re.a,{bsStyle:"success",onDismiss:this.handleDismiss},r.a.createElement("p",null,"Successfully saved to masterfile.")));default:return r.a.createElement("div",null,r.a.createElement(re.a,{bsStyle:"danger",onDismiss:this.handleDismiss},r.a.createElement("p",null,"Network error, please try again!")))}}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("br",null),this.createAlert())}}]),t}(r.a.Component),pe=Object(T.b)(function(e){return{showForms:e.showForms}},function(e){return{closeAlert:function(){return e(W())}}})(de),he=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.props.showForms.alert&&r.a.createElement(pe,null))}}]),t}(i.Component),fe=Object(T.b)(function(e){return{showForms:e.showForms}})(he),ve=n(69),ge=n(15),be=n(147),ye=n.n(be),Oe=n(39),Se=n.n(Oe),Te=function(){function e(){var t=this;Object(o.a)(this,e),this.dndHelper={addSpanBefore:function(e,n){var a=t.getParentDiv(n,e),i=a.items.map(function(e){return e.id}).indexOf(n.id);a.items[i+1]&&"optional"!==a.items[i+1].type&&a.items.splice(i+1,0,t.createDropZoneObject())},addSpanAfter:function(e,n){var a=t.getParentDiv(n,e),i=a.items.map(function(e){return e.id}).indexOf(n.id);a.items.splice(i,0,t.createDropZoneObject())},stuckInMiddle:function(e,t,n){return 0!==e&&e!==t.length-1&&"span"===n.items[e-1].type&&"span"===n.items[e+1].type},addSpanToEmptyHeader:function(e,n){var a=t.findWrapperHeaders(e,n);a.after&&a.after.items.splice(0,0,t.createDropZoneObject())}}}return Object(c.a)(e,[{key:"createDropZoneObject",value:function(){return{type:"optional",id:Se()()}}},{key:"createSpanObject",value:function(e){return{id:Se()(),type:"span",label:e.timespanTitle,begin:e.beginTime,end:e.endTime}}},{key:"deleteListItem",value:function(e,t){var n=Object(ge.cloneDeep)(t),a=this.findItem(e,t),i=this.getParentDiv(a,n),r=Object(ge.findIndex)(i.items,{id:a.id});return i.items.splice(r,1),n}},{key:"determineDropTargets",value:function(e,t){var n=Object(ge.cloneDeep)(t);if("span"===e.type){var a=this.findWrapperSpans(e,this.getItemsOfType("span",n)),i=this.getParentDiv(e,n),r=i?i.items:[],s=r.map(function(e){return e.id}).indexOf(e.id);if(this.dndHelper.stuckInMiddle(s,r,i))return n;if(0!==s&&"div"===r[s-1].type){var l=r[s-1];l.items?l.items.push(this.createDropZoneObject()):l.items=[this.createDropZoneObject()]}if(s!==r.length-1&&"div"===r[s+1].type){var o=r[s+1];o.items?o.items.unshift(this.createDropZoneObject()):o.items=[this.createDropZoneObject()]}var c=this.getParentDiv(i,n),u=c?c.items.map(function(e){return e.id}).indexOf(i.id):null;if(0===s){if(null===u)return n;c&&(c.items.splice(u,0,this.createDropZoneObject()),a.before&&this.dndHelper.addSpanBefore(n,a.before))}a.after&&this.dndHelper.addSpanAfter(n,a.after),a.after||this.dndHelper.addSpanToEmptyHeader(i,n)}return n}},{key:"doesTimeOverlap",value:function(e,t){var n=this.toMs,a=!0;for(var i in e=n(e),t){var r=n(t[i].begin),s=n(t[i].end);if(e>=r&&e<s){a=!1;break}}return a}},{key:"doesTimespanOverlap",value:function(e,t,n){var a=this.toMs,i=n.filter(function(t){return a(e)<a(t.begin)});return 0!==i.length&&a(t)>a(i[0].begin)}},{key:"findItem",value:function(e,t){var n=null;return function t(a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;c.id===e&&(n=c),c.items&&c.items.length>0&&t(c.items)}}catch(u){r=!0,s=u}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(t),n}},{key:"findItemByLabel",value:function(e,t){var n=null;return function t(a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;c.label===e&&(n=c),c.items&&t(c.items)}}catch(u){r=!0,s=u}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(t),n}},{key:"findWrapperSpans",value:function(e,t){var n=this.toMs,a={before:null,after:null},i=t.filter(function(t){return n(e.begin)>=n(t.end)}),r=t.filter(function(t){return n(e.end)<=n(t.begin)});return a.before=i.length>0?i[i.length-1]:null,a.after=r.length>0?r[0]:null,a}},{key:"findWrapperHeaders",value:function(e,t){var n={before:null,after:null},a=this.getParentDiv(e,t),i=a?a.items.map(function(e){return e.label}).indexOf(e.label):null;return n.before=void 0!==a.items[i-1]?a.items[i-1]:null,n.after=void 0!==a.items[i+1]?a.items[i+1]:null,n}},{key:"getItemsOfType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return function t(a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;if(c.type===e){var u=Object(p.a)({},c);delete u.items,n.push(u)}c.items&&t(c.items)}}catch(m){r=!0,s=m}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(t),n}},{key:"getParentDiv",value:function(e,t){var n=null;return function e(t,a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;if(c.items){if(c.items.filter(function(e){return t.id===e.id}).length>0){n=c;break}e(t,c.items)}}}catch(u){r=!0,s=u}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(e,t),n}},{key:"getValidHeadings",value:function(e,t){var n=[],a=[],i=function e(t,a){var i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;if(c.items){if(c.items.filter(function(e){return e.id===t.id}).length>0){c.items;var u=Object(ve.a)(c,["items"]);n.push(u)}e(t,c.items)}}}catch(m){r=!0,s=m}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}},r=this.getItemsOfType("div",t);if(e.before||e.after||(n=r),e.before&&i(e.before,t),e.after&&i(e.after,t),!e.before&&e.after||e.before&&!e.after){var s=this.getValidHeadingForEmptySpans(e,t);n=n.concat(s)}return r.forEach(function(e){var t=!1;n=n.filter(function(n){return!(!t&&n.label===e.label)||(a.push(n),t=!0,!1)})}),a}},{key:"getValidHeadingForEmptySpans",value:function(e,t){var n=this,a=null,i=function(e,a){var i=n.findWrapperHeaders(e,t);switch(a){case"before":return i.before?i.before:e;case"after":return i.after?i.after:e;default:return e}},r=[],s=function e(t,n){if(t!==n){var a=t.items;if(a){var i=!0,s=!1,l=void 0;try{for(var o,c=a[Symbol.iterator]();!(i=(o=c.next()).done);i=!0){var u=o.value;if("div"===u.type){u.items;var m=Object(ve.a)(u,["items"]);r.push(m)}e(u,n)}}catch(d){s=!0,l=d}finally{try{i||null==c.return||c.return()}finally{if(s)throw l}}}}};if(!e.after&&e.before){var l=this.getParentDiv(e.before,t);s(a=i(l,"after"),l)}if(!e.before&&e.after){var o=this.getParentDiv(e.after,t);s(a=i(o,"before"),o)}var c=a,u=(c.items,Object(ve.a)(c,["items"]));return r.push(u),r}},{key:"handleListItemDrop",value:function(e,t,n){var a=Object(ge.cloneDeep)(n),i=this.findItem(e.id,a),r=this.getParentDiv(i,a),s=r.items.map(function(e){return e.id}).indexOf(i.id);r.items.splice(s,1);var l=this.getParentDiv(t,a),o=l.items.map(function(e){return e.id}).indexOf(t.id);return l.items.splice(o,0,i),this.removeDropTargets(a)}},{key:"insertNewHeader",value:function(e,t){var n=Object(ge.cloneDeep)(t),a=this.findItem(e.headingChildOf,n)||n[0];return a&&a.items.unshift({id:Se()(),type:"div",label:e.headingTitle,items:[]}),n}},{key:"insertNewTimespan",value:function(e,t){var n=Object(ge.cloneDeep)(t),a=this.findItem(e.timespanChildOf,n),i=this.createSpanObject(e),r=0;if(a){var s=a.items.filter(function(e){return"span"===e.type}),l=this.findWrapperSpans(i,s);l.before&&(r=Object(ge.findIndex)(a.items,{id:l.before.id})+1),a.items.splice(r,0,i)}return{newSpan:i,updatedData:n}}},{key:"removeActiveDragSources",value:function(e){return[function e(t){return t.items?(t.items=t.items.map(function(t){return e(t)}),t):(t.active&&(t.active=!1),t)}(e[0])]}},{key:"removeDropTargets",value:function(e){return[function e(t,n){return t.items?(t.items=t.items.filter(function(e){return e.type!==n}).map(function(t){return e(t,n)}),t):t}(Object(ge.cloneDeep)(e)[0],"optional")]}},{key:"toMs",value:function(e){return ye.a.duration(e).asMilliseconds()}},{key:"toHHmmss",value:function(e){var t=parseInt(""+100*e)/100,n=Math.floor(t/3600),a=Math.floor(t/60),i=Math.round(t%60*100)/100,r=n<10?"0".concat(n):"".concat(n),s=a<10?"0".concat(a):"".concat(a),l=i.toFixed(2);return l=i<10?"0".concat(l):"".concat(l),"".concat(r,":").concat(s,":").concat(l)}},{key:"updateHeading",value:function(e,t){var n=Object(ge.cloneDeep)(t);return this.findItem(e.id,n).label=e.headingTitle,n}},{key:"validateBeforeEndTimeOrder",value:function(e,t){return!e||!t||!(this.toMs(e)>=this.toMs(t))}},{key:"validTimeFormat",value:function(e){return e&&3===e.split(":").length}}]),e}(),Ee=n(369),ke=new Te;function je(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=ke.findItem(e,t);if("div"===a.type)return{headingTitle:a.label};if("span"===a.type){var i=ke.getParentDiv(a,t);return{beginTime:a.begin,endTime:a.end,timespanChildOf:i?i.id:"",timespanTitle:a.label,clonedSegment:n.segments.getSegment(e)}}}function Ce(e,t){if(!e||-1===e.indexOf(":"))return null;var n=ke.validTimeFormat(e),a=ke.doesTimeOverlap(e,t);return n&&a?"success":n&&a?null:"error"}function De(e,t,n){if(!t||-1===t.indexOf(":"))return null;var a=ke.validTimeFormat(t),i=ke.doesTimeOverlap(t,n),r=ke.validateBeforeEndTimeOrder(e,t),s=ke.doesTimespanOverlap(e,t,n);return a&&i&&r&&!s?"success":a&&i&&r&&!s?null:"error"}function Ie(e){return e.length>2?"success":e.length>0?"error":null}function we(e){return e.length>2}function xe(e,t,n,a){return ke.validTimeFormat(e)?ke.validTimeFormat(t)?ke.doesTimeOverlap(e,n)?ke.doesTimeOverlap(t,n)?ke.validateBeforeEndTimeOrder(e,t)?ke.doesTimespanOverlap(e,t,n)?{valid:!1,message:"New timespan region overlaps an existing timespan region"}:{valid:!0}:{valid:!1,message:"Begin time must start before end time"}:{valid:!1,message:"End time overlaps an existing timespan region"}:{valid:!1,message:"Begin time overlaps an existing timespan region"}:{valid:!1,message:"Invalid end time format"}:{valid:!1,message:"Invalid begin time format"}}var Me=new Te,Ne=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={headingTitle:"",headingChildOf:"",childOfOptions:[]},n.handleCancelClick=function(){n.props.toggleHeading()},n.handleChildOfChange=function(e){n.setState({headingChildOf:e.target.value})},n.handleHeadingChange=function(e){n.setState({headingTitle:e.target.value})},n.handleSubmit=function(e){var t=n.state,a={headingChildOf:t.headingChildOf,headingTitle:t.headingTitle};e.preventDefault(),n.props.onSubmit(a),n.clearFormValues()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.smData.length>0&&this.processOptions()}},{key:"componentDidUpdate",value:function(e){Object(ge.isEqual)(this.props.smData,e.smData)||this.processOptions()}},{key:"clearFormValues",value:function(){this.setState({headingTitle:"",headingChildOf:"",childOfOptions:[]})}},{key:"formIsValid",value:function(){var e=this.state.headingTitle;return e&&e.length>0}},{key:"getOptions",value:function(){return Me.getItemsOfType("div",this.props.smData).map(function(e){return r.a.createElement("option",{value:e.id,key:e.id},e.label)})}},{key:"processOptions",value:function(){var e=this.getOptions();this.setState({childOfOptions:e})}},{key:"render",value:function(){var e=this.state.headingTitle;return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement(Y.a,{controlId:"headingTitle",validationState:Ie(e)},r.a.createElement(Ee.a,null,"Title"),r.a.createElement(ee.a,{type:"text",value:e,onChange:this.handleHeadingChange}),r.a.createElement(ee.a.Feedback,null)),r.a.createElement(Y.a,{controlId:"headingChildOf"},r.a.createElement(Ee.a,null,"Child Of"),r.a.createElement(ee.a,{componentClass:"select",placeholder:"select",onChange:this.handleChildOfChange,value:this.state.headingChildOf},r.a.createElement("option",{value:""},"Select..."),this.state.childOfOptions)),r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:12},r.a.createElement($.a,{className:"pull-right"},r.a.createElement(X.a,{onClick:this.props.cancelClick},"Cancel"),r.a.createElement(X.a,{bsStyle:"primary",type:"submit",disabled:!this.formIsValid()},"Save")))))}}]),t}(i.Component),He=Object(T.b)(function(e){return{smData:e.smData}},a)(Ne);function Ae(e){return{type:k,payload:e}}var Re=new Te,Fe=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={message:null},n.submit=function(e){var t,a=n.props.smData,i={headingChildOf:e.headingChildOf,headingTitle:e.headingTitle};t=Re.insertNewHeader(i,a),n.props.buildSMUI(t),n.props.cancelClick()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(He,{onSubmit:this.submit,cancelClick:this.props.cancelClick})}}]),t}(i.Component),Pe=Object(T.b)(function(e){return{smData:e.smData}},function(e){return{buildSMUI:function(t){return e(Ae(t))}}})(Fe),_e=n(27),Ve=new Te,ze=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).buildHeadingsOptions=function(){var e=n.props.smData,t={begin:n.state.beginTime,end:n.state.endTime},a=Ve.findWrapperSpans(t,n.allSpans),i=Ve.getValidHeadings(a,e);n.setState({validHeadings:i})},n.clearHeadingOptions=function(){n.setState({validHeadings:[]})},n.handleInputChange=function(e){n.setState(Object(_e.a)({},e.target.id,e.target.value)),n.updateChildOfOptions()},n.handleSubmit=function(e){e.preventDefault();var t=n.state,a=t.beginTime,i=t.endTime,r=t.timespanChildOf,s=t.timespanTitle;n.props.cancelClick(),n.props.onSubmit({beginTime:a,endTime:i,timespanChildOf:r,timespanTitle:s}),n.clearFormValues()},n.handleTimeChange=function(e,t){n.setState({isTyping:!0}),n.setState(Object(_e.a)({},e.target.id,e.target.value),function(){t(),n.updateChildOfOptions();var e=n.props,a=e.initSegment,i=e.peaksInstance.peaks.segments.getSegment(a.id);n.props.updateSegment(i,n.state)})},n.handleCancelClick=function(){n.props.cancelClick()},n.handleChildOfChange=function(e){n.setState({timespanChildOf:e.target.value})},n.state={beginTime:"",endTime:"",timespanChildOf:"",timespanTitle:"",validHeadings:[],isTyping:!1},n.allSpans=null,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.smData;Object(ge.isEqual)(t,e.smData)||(this.allSpans=Ve.getItemsOfType("span",t))}},{key:"componentWillReceiveProps",value:function(e){if(e.timespanOpen&&!this.state.isTyping){var t=e.initSegment,n=e.isInitializing,a=e.peaksInstance,i=e.segment;if(t!==this.props.initSegment&&n){var r=t.startTime,s=t.endTime;this.setState({beginTime:Ve.toHHmmss(r),endTime:Ve.toHHmmss(s)}),this.props.updateInitialize(!1)}if(this.props.peaksInstance!==a&&!n){var l=i.startTime,o=i.endTime;this.setState({beginTime:Ve.toHHmmss(l),endTime:Ve.toHHmmss(o)},this.updateChildOfOptions())}}}},{key:"clearFormValues",value:function(){this.setState({beginTime:"",endTime:"",timespanChildOf:"",timespanTitle:"",validHeadings:[],isTyping:!1})}},{key:"formIsValid",value:function(){var e=we(this.state.timespanTitle),t=this.state.timespanChildOf.length>0,n=this.localValidTimespans();return e&&t&&n.valid}},{key:"updateChildOfOptions",value:function(){this.localValidTimespans().valid?this.buildHeadingsOptions():this.clearHeadingOptions()}},{key:"localValidTimespans",value:function(){var e=this.state;return xe(e.beginTime,e.endTime,this.allSpans,this.props.smData)}},{key:"render",value:function(){var e=this,t=this.state,n=t.beginTime,a=t.endTime,i=t.timespanChildOf,s=t.timespanTitle;return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement(Y.a,{controlId:"timespanTitle",validationState:Ie(s)},r.a.createElement(Ee.a,null,"Title"),r.a.createElement(ee.a,{type:"text",value:s,onChange:this.handleInputChange}),r.a.createElement(ee.a.Feedback,null)),r.a.createElement(J.a,null,r.a.createElement(K.a,{sm:6},r.a.createElement(Y.a,{controlId:"beginTime",validationState:Ce(n,this.allSpans)},r.a.createElement(Ee.a,null,"Begin Time"),r.a.createElement(ee.a,{type:"text",value:n,placeholder:"00:00:00",onChange:function(t){e.handleTimeChange(t,function(){e.setState({isTyping:!1})})}}),r.a.createElement(ee.a.Feedback,null))),r.a.createElement(K.a,{sm:6},r.a.createElement(Y.a,{controlId:"endTime",validationState:De(n,a,this.allSpans)},r.a.createElement(Ee.a,null,"End Time"),r.a.createElement(ee.a,{type:"text",value:a,placeholder:"00:00:00",onChange:function(t){e.handleTimeChange(t,function(){e.setState({isTyping:!1})})}}),r.a.createElement(ee.a.Feedback,null)))),r.a.createElement(Y.a,{controlId:"timespanChildOf"},r.a.createElement(Ee.a,null,"Child Of"),r.a.createElement(ee.a,{componentClass:"select",placeholder:"select",onChange:this.handleChildOfChange,value:i},r.a.createElement("option",{value:""},"Select..."),this.state.validHeadings.map(function(e){return r.a.createElement("option",{value:e.id,key:e.id},e.label)}))),r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:12},r.a.createElement($.a,{className:"pull-right"},r.a.createElement(X.a,{onClick:this.handleCancelClick},"Cancel"),r.a.createElement(X.a,{bsStyle:"primary",type:"submit",disabled:!this.formIsValid()},"Save")))))}}]),t}(i.Component),Be={updateSegment:U},Ue=ze=Object(T.b)(function(e){return{smData:e.smData,peaksInstance:e.peaksInstance,segment:e.peaksInstance.segment}},Be)(ze),Le=new Te,Ge=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={message:null},n.submit=function(e){var t=Le.insertNewTimespan(e,n.props.smData),a=t.newSpan,i=t.updatedData;n.props.insertNewSegment(a),n.props.buildSMUI(i),n.props.cancelClick()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(Ue,Object.assign({},this.props,{onSubmit:this.submit}))}}]),t}(i.Component),We=Object(T.b)(function(e){return{smData:e.smData}},function(e){return{buildSMUI:function(t){return e(Ae(t))},insertNewSegment:function(t){return e({type:N,payload:t})}}})(Ge),qe={section:{margin:"4rem 0"},well:{marginTop:"1rem"}},Ze=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={headingOpen:!1,timespanOpen:!1,initSegment:null,isInitializing:!0},n.updateInitializeFlag=function(e){n.setState({isInitializing:e})},n.handleCancelHeadingClick=function(){n.setState({headingOpen:!1})},n.handleCancelTimespanClick=function(){n.props.deleteTempSegment(n.state.initSegment.id),n.setState({timespanOpen:!1})},n.handleHeadingClick=function(){null!==n.state.initSegment&&n.props.deleteTempSegment(n.state.initSegment.id),n.setState({headingOpen:!0,timespanOpen:!1})},n.handleTimeSpanClick=function(){n.createDefaultSegment(),n.setState({headingOpen:!1,timespanOpen:!0,isInitializing:!0})},n.createDefaultSegment=function(){if(!n.state.timespanOpen){n.props.createTempSegment();var e=n.props.peaksInstance.peaks.segments.getSegment("temp-segment");n.setState({initSegment:e})}},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e={cancelClick:this.handleCancelTimespanClick,initSegment:this.state.initSegment,isInitializing:this.state.isInitializing,timespanOpen:this.state.timespanOpen,updateInitialize:this.updateInitializeFlag};return r.a.createElement("section",{style:qe.section},r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:6},r.a.createElement(X.a,{block:!0,onClick:this.handleHeadingClick},"Add a Heading")),r.a.createElement(K.a,{xs:6},r.a.createElement(X.a,{block:!0,onClick:this.handleTimeSpanClick},"Add a Timespan"))),r.a.createElement(me.a,{in:this.state.headingOpen},r.a.createElement("div",{className:"well",style:qe.well},r.a.createElement(Pe,{cancelClick:this.handleCancelHeadingClick}))),r.a.createElement(me.a,{in:this.state.timespanOpen},r.a.createElement("div",{className:"well",style:qe.well},r.a.createElement(We,e))),r.a.createElement(fe,null))}}]),t}(i.Component),Je={createTempSegment:function(){return{type:V}},deleteTempSegment:function(e){return{type:z,payload:e}}},Ke=Object(T.b)(function(e){return{smData:e.smData,peaksInstance:e.peaksInstance}},Je)(Ze),Qe="span",Ye=n(32),$e=n(370),Xe=n(373),et=n(33),tt=function(e){return r.a.createElement($e.a,{id:"tooltip"},e)},nt=function(e){return r.a.createElement("div",{className:"edit-controls-wrapper"},r.a.createElement(Xe.a,{placement:"left",overlay:tt("Save")},r.a.createElement(X.a,{bsStyle:"link",disabled:!e.formIsValid,onClick:e.handleSaveClick},r.a.createElement(et.a,{icon:"save"}))),r.a.createElement(Xe.a,{placement:"right",overlay:tt("Cancel"),onClick:e.handleCancelClick},r.a.createElement(X.a,{bsStyle:"link"},r.a.createElement(et.a,{icon:"minus-circle"}))))},at=new Te,it={formControl:{margin:"0 5px"}},rt=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={beginTime:"",endTime:"",timespanTitle:"",clonedSegment:{},isTyping:!1},n.handleCancelClick=function(){n.props.revertSegment(n.state.clonedSegment),n.props.cancelFn()},n.handleInputChange=function(e,t){n.setState({isTyping:!0}),n.setState(Object(_e.a)({},e.target.id,e.target.value),function(){t();var e=n.props,a=e.item,i=e.peaksInstance.peaks.segments.getSegment(a.id);n.props.updateSegment(i,n.state)})},n.handleSaveClick=function(){n.props.saveSegment(n.state);var e=n.state,t=e.beginTime,a=e.endTime,i=e.timespanTitle;n.props.saveFn(n.props.item.id,{beginTime:t,endTime:a,timespanTitle:i})},n.tempSmData=void 0,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.smData,n=e.item,a=e.peaksInstance;this.tempSmData=Object(ge.cloneDeep)(t),this.setState(je(n.id,this.tempSmData,a.peaks)),this.tempSmData=at.deleteListItem(n.id,this.tempSmData),this.allSpans=at.getItemsOfType("span",this.tempSmData),this.props.activateSegment(n.id),this.props.changeSegment()}},{key:"componentWillReceiveProps",value:function(e){this.props.peaksInstance!==e.peaksInstance&&e.segment&&!this.state.isTyping&&this.setState({beginTime:at.toHHmmss(e.segment.startTime),endTime:at.toHHmmss(e.segment.endTime)})}},{key:"formIsValid",value:function(){var e=this.state,t=e.beginTime,n=e.endTime,a=we(this.state.timespanTitle),i=xe(t,n,this.allSpans,this.tempSmData);return a&&i.valid}},{key:"render",value:function(){var e=this,t=this.state,n=t.beginTime,a=t.endTime,i=t.timespanTitle;return r.a.createElement(Q.a,{inline:!0},r.a.createElement("div",{className:"row-wrapper"},r.a.createElement("div",null,r.a.createElement(Y.a,{controlId:"timespanTitle",validationState:Ie(i)},r.a.createElement(Ee.a,null,"Title"),r.a.createElement(ee.a,{type:"text",style:it.formControl,value:i,onChange:function(t){e.handleInputChange(t,function(){e.setState({isTyping:!1})})}})),r.a.createElement(Y.a,{controlId:"beginTime",validationState:Ce(n,this.allSpans)},r.a.createElement(Ee.a,null,"Begin Time"),r.a.createElement(ee.a,{type:"text",style:it.formControl,value:n,onChange:function(t){e.handleInputChange(t,function(){e.setState({isTyping:!1})})}})),r.a.createElement(Y.a,{controlId:"endTime",validationState:De(n,a,this.allSpans)},r.a.createElement(Ee.a,null,"End Time"),r.a.createElement(ee.a,{type:"text",style:it.formControl,value:a,onChange:function(t){e.handleInputChange(t,function(){e.setState({isTyping:!1})})}}))),r.a.createElement(nt,{formIsValid:this.formIsValid(),handleSaveClick:this.handleSaveClick,handleCancelClick:this.handleCancelClick})))}}]),t}(i.Component),st={activateSegment:function(e){return{type:A,payload:e}},revertSegment:function(e){return{type:F,payload:e}},saveSegment:function(e){return{type:R,payload:e}},updateSegment:U,changeSegment:L},lt=Object(T.b)(function(e){return{smData:e.smData,peaksInstance:e.peaksInstance,segment:e.peaksInstance.segment}},st)(rt),ot={formControl:{margin:"0 5px",width:"300px"}},ct=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={headingTitle:""},n.handleCancelClick=function(){n.props.cancelFn()},n.handleInputChange=function(e){n.setState(Object(_e.a)({},e.target.id,e.target.value))},n.handleSaveClick=function(){var e=n.state.headingTitle;n.props.saveFn(n.props.item.id,{headingTitle:e})},n.tempSmData=void 0,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.smData;this.tempSmData=Object(ge.cloneDeep)(e),this.setState(je(this.props.item.id,this.tempSmData))}},{key:"formIsValid",value:function(){return we(this.state.headingTitle)}},{key:"render",value:function(){var e=this.state.headingTitle;return r.a.createElement(Q.a,{inline:!0},r.a.createElement("div",{className:"row-wrapper"},r.a.createElement("div",null,r.a.createElement(Y.a,{controlId:"headingTitle",validationState:Ie(e)},r.a.createElement(Ee.a,null,"Title"),r.a.createElement(ee.a,{type:"text",style:ot.formControl,value:e,onChange:this.handleInputChange}))),r.a.createElement(nt,{formIsValid:this.formIsValid(),handleSaveClick:this.handleSaveClick,handleCancelClick:this.handleCancelClick})))}}]),t}(i.Component),ut=Object(T.b)(function(e){return{smData:e.smData}})(ct),mt=new Te,dt=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleCancelClick=function(e){n.props.handleEditFormCancel()},n.handleSaveClick=function(e,t){var a=Object(ge.cloneDeep)(n.props.smData),i=mt.findItem(e,a);i=n.addUpdatedValues(i,t),n.props.buildSMUI(a),n.props.handleEditFormCancel()},n.type=n.props.item.type,n.id=n.props.item.id,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"addUpdatedValues",value:function(e,t){return"div"===e.type?e.label=t.headingTitle:"span"===e.type&&(e.label=t.timespanTitle,e.begin=t.beginTime,e.end=t.endTime),e}},{key:"render",value:function(){var e=this.props.item;return"span"===e.type?r.a.createElement(lt,{item:e,cancelFn:this.handleCancelClick,saveFn:this.handleSaveClick}):"div"===e.type?r.a.createElement(ut,{item:e,cancelFn:this.handleCancelClick,saveFn:this.handleSaveClick}):void 0}}]),t}(i.Component),pt=Object(T.b)(function(e){return{smData:e.smData}},function(e){return{buildSMUI:function(t){return e(Ae(t))}}})(dt),ht=function(e){return r.a.createElement($e.a,{id:"tooltip"},e)},ft=Object(T.b)(function(e){return{showForms:e.showForms}})(function(e){var t=e.itemType,n=e.handleShowDropTargetsClick,a=e.handleEditClick,i=e.handleDelete,s=e.showForms;return r.a.createElement("div",{className:"edit-controls-wrapper"},"span"===t&&r.a.createElement(Xe.a,{placement:"left",overlay:ht("Show drop targets")},r.a.createElement(X.a,{bsStyle:"link",disabled:s.disabled,onClick:n},r.a.createElement(et.a,{icon:"dot-circle"}))),r.a.createElement(Xe.a,{placement:"top",overlay:ht("Edit")},r.a.createElement(X.a,{bsStyle:"link",onClick:a,disabled:s.disabled},r.a.createElement(et.a,{icon:"pen"}))),r.a.createElement(Xe.a,{placement:"right",overlay:ht("Delete")},r.a.createElement(X.a,{bsStyle:"link",onClick:i,disabled:s.disabled},r.a.createElement(et.a,{icon:"trash"}))))});var vt=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={editing:!1},n.handleDelete=function(){var e=n.props.item;n.props.deleteItem(e.id),n.props.deleteSegment(e)},n.handleEditClick=function(){var e=n.props.item;e.id,e.type;n.props.handleEditingTimespans(0),n.setState({editing:!0})},n.handleEditFormCancel=function(){n.setState({editing:!1}),n.props.handleEditingTimespans(1)},n.handleShowDropTargetsClick=function(){var e=n.props,t=e.addDropTargets,a=e.item,i=e.removeActiveDragSources,r=e.removeDropTargets,s=e.setActiveDragSource;r(),!0!==a.active?(i(),t(a),s(a.id)):i()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.item.begin,a=e.item.end,i=e.item.items,s=e.item.label,l=e.item.type,o=e.item.active,c=e.connectDragSource,u=e.connectDropTarget,m=i&&i.length>0?r.a.createElement(kt,{items:i}):null;return c(u(r.a.createElement("li",{className:o?"active":""},this.state.editing&&r.a.createElement(pt,{item:t,handleEditFormCancel:this.handleEditFormCancel}),!this.state.editing&&r.a.createElement("div",{className:"row-wrapper"},"span"===l&&r.a.createElement("span",{className:"structure-title"},s," (",n," - ",a,")"),"div"===l&&r.a.createElement("div",{className:"structure-title heading"},s),r.a.createElement(ft,{handleDelete:this.handleDelete,handleEditClick:this.handleEditClick,itemType:l,handleShowDropTargetsClick:this.handleShowDropTargetsClick})),m)))}}]),t}(i.Component),gt={deleteItem:function(e){return{type:j,id:e}},addDropTargets:function(e){return{type:C,payload:e}},removeDropTargets:function(){return{type:D}},removeActiveDragSources:function(){return{type:w}},setActiveDragSource:function(e){return{type:I,id:e}},deleteSegment:function(e){return{type:H,payload:e}},handleEditingTimespans:q},bt=Object(Ye.DropTarget)(Qe,{canDrop:function(e,t){return!0}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),isOverCurrent:t.isOver({shallow:!0}),canDrop:t.canDrop(),itemType:t.getItemType()}})(Object(Ye.DragSource)(Qe,{beginDrag:function(e){return{id:e.item.id}}},function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}})(vt)),yt=Object(T.b)(function(e){return{smData:e.smData}},gt)(bt),Ot={li:{border:"2px #999 dashed",opacity:.3},liHovered:{border:"5px #999 dashed",opacity:.5}};var St=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isOver;return(0,e.connectDropTarget)(r.a.createElement("li",{className:"row-wrapper",style:t?Ot.liHovered:Ot.li},"Drop here"))}}]),t}(i.Component),Tt=Object(Ye.DropTarget)(Qe,{hover:function(e,t,n){},drop:function(e,t,n){var a=t.getItem();e.handleListItemDrop(a,e.item)}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),isOverCurrent:t.isOver({shallow:!0}),canDrop:t.canDrop(),itemType:t.getItemType()}})(St),Et=Object(T.b)(null,function(e){return{handleListItemDrop:function(t,n){return e({type:x,dragSource:t,dropTarget:n})}}})(Tt),kt=function(e){return r.a.createElement("ul",{className:"structure-list"},e.items.map(function(e,t){return e?"optional"===e.type?r.a.createElement(Et,{key:t,item:e}):r.a.createElement(yt,{key:e.id,item:e}):null}))},jt=new S,Ct=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(v.a)(f.a.mark(function e(){var t,n,a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,jt.getRequest("structure.json");case 3:t=e.sent,n=t.data,a=this.addIds([n]),this.props.buildSMUI(a),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),void 0!==e.t0.response?this.props.handleResponse(e.t0.response.status):void 0!==e.t0.request?this.props.handleResponse(e.t0.request.status):this.props.handleResponse(-1);case 12:case"end":return e.stop()}},e,this,[[0,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"addIds",value:function(e){var t=Object(ge.cloneDeep)(e);return function e(t){var n=!0,a=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;l.id=Se()(),l.items&&l.items.length>0&&e(l.items)}}catch(o){a=!0,i=o}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}}(t),t}},{key:"render",value:function(){return null}}]),t}(i.Component),Dt=Object(T.b)(null,function(e){return{buildSMUI:function(t){return e(Ae(t))},handleResponse:function(t){return e(G(t))}}})(Ct),It=new S,wt=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).handleSaveItClick=function(){var e={json:n.props.smData[0]};It.postRequest("structure.json",e).then(function(e){n.props.handleResponse(e.status,e.statusText)}).catch(function(e){void 0!==e.response?n.props.handleResponse(e.response.status):n.props.handleResponse(e.request.status)})},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.smData,t=void 0===e?[]:e;return r.a.createElement("section",null,r.a.createElement("h3",null,"HTML Structure Tree from a masterfile in server"),r.a.createElement("br",null),r.a.createElement(Dt,null),r.a.createElement(kt,{items:t}),r.a.createElement(J.a,null,r.a.createElement(K.a,{xs:12,className:"text-right"},r.a.createElement(X.a,{bsStyle:"primary",onClick:this.handleSaveItClick},"Save Structure"))))}}]),t}(i.Component),xt=Object(T.b)(function(e){return{smData:e.smData}},a)(wt),Mt=n(150),Nt=n.n(Mt),Ht=n(50),At=n(40);Ht.b.add(At.a,At.b,At.c,At.d,At.e);var Rt=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(Ye.DragDropContextProvider,{backend:Nt.a},r.a.createElement("div",{className:"container"},r.a.createElement("h1",null,"Test Structural Metadata Editor"),r.a.createElement(ue,null),r.a.createElement(Ke,null),r.a.createElement(xt,null)))}}]),t}(i.Component),Ft=n(29),Pt={alert:!1,disabled:!1},_t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"API_RESPONSE":return Object.assign({},e,{statusCode:t.code,alert:!0});case"CLOSE_ALERT":return Object.assign({},e,{alert:!1,blocking:!1});case"IS_EDITING_TIMESPAN":return 0===t.code?Object.assign({},e,{statusCode:t.code,disabled:!0}):Object.assign({},e,{statusCode:t.code,disabled:!1});default:return e}},Vt=new Te,zt=[],Bt=null,Ut=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return(Bt=Object(ge.cloneDeep)(e)).push(t.payload),Bt;case k:return t.payload;case j:return Vt.deleteListItem(t.id,e);case C:return Vt.determineDropTargets(t.payload,e);case D:return Vt.removeDropTargets(e);case I:return Bt=Object(ge.cloneDeep)(e),Vt.findItem(t.id,Bt).active=!0,Bt;case w:return Vt.removeActiveDragSources(e);case x:return Vt.handleListItemDrop(t.dragSource,t.dropTarget,e);default:return e}},Lt=n(41),Gt=["#80A590","#2A5459","#FBB040"],Wt=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"initSegments",value:function(e){var t=this,n=[],a=0;return function e(i){var r=!0,s=!1,l=void 0;try{for(var o,c=i[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var u=o.value;if("span"===u.type){a=a>1?0:a;var m=u.begin,d=u.end,p=u.label,h=u.id;n.push({startTime:t.toMs(m),endTime:t.toMs(d),labelText:p,id:h,color:Gt[a]}),a++}u.items&&u.items.length>0&&e(u.items)}}catch(f){s=!0,l=f}finally{try{r||null==c.return||c.return()}finally{if(s)throw l}}}(e),n}},{key:"insertNewSegment",value:function(e,t){var n=e.begin,a=e.end,i=e.label,r=e.id;return t.segments.add({startTime:this.toMs(n),endTime:this.toMs(a),labelText:i,id:r}),t}},{key:"insertTempSegment",value:function(e){var t,n=e.player.getCurrentTime(),a=this.sortSegments(e.segments.getSegments(),"startTime");return a.map(function(e){return n>=e.startTime&&n<e.endTime&&(n=e.endTime+.01),n}),t=n+60,a.map(function(e){return t>=e.startTime&&t<e.endTime&&(t=e.startTime-.01),t}),e.player.seek(n),e.segments.add({startTime:n,endTime:t,editable:!0,color:Gt[2],id:"temp-segment"}),e}},{key:"deleteSegments",value:function(e,t){return"div"===e.type&&function e(n){var a=n.items,i=!0,r=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;"span"===c.type&&t.segments.removeById(c.id),c.items&&c.items.length>0&&e(c)}}catch(u){r=!0,s=u}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}}(e),t.segments.removeById(e.id),t}},{key:"rebuildPeaks",value:function(e){var t=this,n=this.sortSegments(e.segments.getSegments(),"startTime");return e.segments.removeAll(),n.forEach(function(n,a){n.color=t.isOdd(a)?Gt[1]:Gt[0],e.segments.add(n)}),e}},{key:"activateSegment",value:function(e,t){var n=t.segments.removeById(e),a=Object(Lt.a)(n,1)[0];t.segments.add(Object(p.a)({},a,{editable:!0,color:Gt[2]}));var i=t.segments.getSegment(e).startTime;return t.player.seek(i),t}},{key:"deactivateSegment",value:function(e,t){var n=this.sortSegments(t.segments.getSegments(),"startTime").map(function(e){return e.id}).indexOf(e),a=t.segments.removeById(e),i=Object(Lt.a)(a,1)[0];return t.segments.add(Object(p.a)({},i,{editable:!1,color:this.isOdd(n)?Gt[1]:Gt[0]})),t}},{key:"saveSegment",value:function(e,t){var n=e.beginTime,a=e.endTime,i=e.clonedSegment;return t.segments.removeById(i.id),t.segments.add(Object(p.a)({},i,{startTime:this.toMs(n),endTime:this.toMs(a)})),t}},{key:"revertSegment",value:function(e,t){return t.segments.removeById(e.id),t.segments.add(e),t}},{key:"updateSegment",value:function(e,t,n){var a=t.beginTime,i=t.endTime,r=this.toMs(a),s=this.toMs(i);if(r<e.endTime&&e.startTime!==r){var l=n.segments.removeById(e.id),o=Object(Lt.a)(l,1)[0];return n.segments.add(Object(p.a)({},o,{startTime:r})),n}if(s>e.startTime&&e.endTime!==s){var c=n.segments.removeById(e.id),u=Object(Lt.a)(c,1)[0];return n.segments.add(Object(p.a)({},u,{endTime:s})),n}return n}},{key:"isOdd",value:function(e){return e%2}},{key:"toMs",value:function(e){var t=e.split(":"),n=Object(Lt.a)(t,3),a=n[0],i=n[1],r=n[2];return 3600*parseInt(a)+60*parseInt(i)+(""===r?0:parseFloat(r))}},{key:"sortSegments",value:function(e,t){return e.sort(function(e,n){return e[t]-n[t]})}}]),e}(),qt=n(151),Zt=n.n(qt),Jt=n(371),Kt=new Wt,Qt={peaks:{},events:null,segment:null},Yt=null,$t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:var n=Kt.initSegments(t.smData),a=Zt.a.init(Object(p.a)({},t.options,{segments:n}));return{peaks:a,events:Object(Jt.a)(a,"segments.dragged"),segment:Object(p.a)({},e.segment)};case N:return Yt=Kt.insertNewSegment(t.payload,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:Kt.rebuildPeaks(Yt)});case H:return Yt=Kt.deleteSegments(t.payload,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:Kt.rebuildPeaks(Yt)});case A:return Yt=Kt.activateSegment(t.payload,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:Yt});case R:Yt=Kt.deactivateSegment(t.payload.clonedSegment.id,Object(p.a)({},e.peaks));var i=Kt.saveSegment(t.payload,Object(p.a)({},Yt));return Object(p.a)({},e,{peaks:i});case F:return Yt=Kt.deactivateSegment(t.payload.id,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:Kt.revertSegment(t.payload,Object(p.a)({},Yt))});case P:return Yt=Kt.updateSegment(t.segment,t.state,Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:Object(p.a)({},Yt)});case _:return Object(p.a)({},e,{segment:t.payload});case V:return Yt=Kt.insertTempSegment(Object(p.a)({},e.peaks)),Object(p.a)({},e,{peaks:Object(p.a)({},Yt)});case z:return e.peaks.segments.removeById(t.payload),Object(p.a)({},e);default:return e}},Xt=Object(Ft.combineReducers)({showForms:_t,smData:Ut,peaksInstance:$t}),en=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function tn(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var nn=n(152),an=Object(Ft.createStore)(Xt,Object(Ft.applyMiddleware)(nn.a));l.a.render(r.a.createElement(T.a,{store:an},r.a.createElement(Rt,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/structured-metadata-editor-react",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/structured-metadata-editor-react","/service-worker.js");en?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):tn(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):tn(e)})}}()}},[[153,1,2]]]);
//# sourceMappingURL=main.8dddd555.chunk.js.map